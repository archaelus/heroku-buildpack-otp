#!/bin/sh

set -e

bpdir=$(cd $(dirname $(dirname $0)); pwd)
mkdir -p "$1" "$2"
build=$(cd "$1/" && pwd)
test -z ${build} && exit
cache=$(cd "$2/" && pwd)
test -z ${cache} && exit

unset GIT_DIR

indent() {
  sed -u 's/^/       /'
}

cd ${build}
REL_DIR=${build}/release

mkdir -p ${REL_DIR}

for i in common_test diameter erl_docgen et gs inviso jinterface megaco observer odbc percept test_server wx; do
  touch lib/${i}/SKIP
  echo "-------> Disabling ${i}"
done

echo "-----> Building Erlang/OTP"
./otp_build all -a ${REL_DIR} 2>&1 | indent
echo "---> done"
